{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
</head>
<body class="d-flex">

<!-- Sidebar -->
<nav class="sidebar bg-dark text-white d-flex flex-column justify-content-between p-3"
     style="width: 220px; height: 100vh; position: fixed; top: 0; left: 0; z-index: 1030;">
  <div class="text-center mb-4">
    <a href="{% url 'front_page' %}" class="text-white text-decoration-none">
      <img src="{% static 'images/logo1.png' %}" alt="Logo" width="50" height="50" class="mb-2">
      <h5>Home</h5>
    </a>
  </div>
  <div>
    <div>
      <!-- Sidebar Buttons -->
      <a href="{% url 'admin_dashboard' %}"
        class="btn w-100 mb-2 {% if request.resolver_match.url_name == 'admin_dashboard' %}btn-primary active{% else %}btn-outline-primary{% endif %}">
        User's Order
      </a>

      <a href="{% url 'admin_all_orders_overview' %}"
        class="btn w-100 mb-2 {% if request.resolver_match.url_name == 'admin_all_orders_overview' %}btn-primary active{% else %}btn-outline-primary{% endif %}">
        Overview
      </a>

      <a href="{% url 'admin_summary' %}"
        class="btn w-100 mb-2 {% if request.resolver_match.url_name == 'admin_summary' %}btn-primary active{% else %}btn-outline-primary{% endif %}">
        Summary
      </a>

      <a href="{% url 'admin_machine_env' %}"
        class="btn w-100 mb-2 {% if request.resolver_match.url_name == 'admin_machine_env' %}btn-primary active{% else %}btn-outline-primary{% endif %}">
        Factory Environment
      </a>

      <a href="{% url 'admin_fjsp1' %}"
        class="btn w-100 mb-2 {% if request.resolver_match.url_name == 'admin_fjsp1' %}btn-primary active{% else %}btn-outline-primary{% endif %}">
        Flexible Scheduling
      </a>

    </div>
  </div>
  <div class="mt-auto">
    <a href="/admin/" class="btn btn-outline-light w-100 mt-5">Producer Administration</a>
    <a href="{% url 'logout' %}" class="btn btn-outline-light w-100 mt-3 mb-3">Logout</a>
  </div>
</nav>

<!-- Main Content -->
<!-- Main Content -->
<div class="flex-grow-1 p-4 bg-light d-flex justify-content-center" style="margin-left: 220px;">
  <div class="w-100">
    <!-- Full-width Title Section -->
    <div class="admin-title-full text-center py-4 mb-4" style="background-color: #0d6efd; color: white; border-radius: 6px;">
      <h2 class="m-0 text-white">All Orders by Users</h2>
    </div>

    <!-- Centered Container -->
    <div class="container" style="max-width: 960px;">
      {% if users %}
        <div class="mb-4 text-center">
          <h5>Select a user to view orders:</h5>
          <div class="d-flex flex-wrap justify-content-center gap-2 mt-3">
            {% for username in users %}
              <button class="btn btn-outline-primary user-btn" data-user="{{ username }}">{{ username|title }}</button>
            {% endfor %}
          </div>
        </div>

        {% for username, files in user_orders.items %}
          <div class="user-orders mt-4" id="orders-{{ username }}" style="display: none;">
            <h4 class="text-success">{{ username|title }}'s Orders</h4>
            {% for entry in files %}
              <div class="card mt-3 mb-4 shadow-sm">
                <div class="card-header bg-secondary text-white">
                  <strong>Submitted on: </strong> {{ entry.formatted_time }}
                </div>
                <div class="card-body p-0">
                  <table class="table table-bordered mb-0">
                    <thead class="table-light">
                      <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for order in entry.orders %}
                        <tr>
                          <td>{{ order.product }}</td>
                          <td>{{ order.quantity }}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-info text-center">No orders found from any user.</div>
      {% endif %}
    </div>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".user-btn");
    const sections = document.querySelectorAll(".user-orders");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const userId = btn.getAttribute("data-user");
        sections.forEach(sec => sec.style.display = "none");
        document.getElementById("orders-" + userId).style.display = "block";
      });
    });
  });
</script>

</body>
</html>
